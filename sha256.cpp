/*
* FIPS-180-2 compliant SHA-256 implementation
*
* Copyright (C) 2001-2003 Christophe Devine
*
* Modified by Marty Joosten http://gamingheavens.com
* This version of sha is specific to a 32 byte implementation. 
* It will not hash correctly with anything less than 32.
*
* This program is free software; you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation; either version 2 of the License, or
* (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
* GNU General Public License for more details.
*
* You should have received a copy of the GNU General Public License
* along with this program; if not, write to the Free Software
* Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
*/

#include "sha256.h"

#define GET_UINT32(n,b,i) \
{ \
(n) = ((uint32) (b)[(i) ] << 24) \
| ((uint32) (b)[(i) + 1] << 16) \
| ((uint32) (b)[(i) + 2] << 8) \
| ((uint32) (b)[(i) + 3]); \
}

#define PUT_UINT32(n,b,i) \
{ \
(b)[(i) ] = (uint8) ((n) >> 24); \
(b)[(i) + 1] = (uint8) ((n) >> 16); \
(b)[(i) + 2] = (uint8) ((n) >> 8); \
(b)[(i) + 3] = (uint8) ((n)); \
}

#define SHR(e, n) (e >> n)

#define P(A, B, C, D, E, F, G, H, x, K) \
{ \
temp1 = H + (((E >> 6) | (E << 26)) ^ ((E >> 11) | (E << 21)) ^ ((E >> 25) | (E << 7))) + (G ^ (E & (F ^ G))) + K + x; \
temp2 = (((A >> 2) | (A << 30)) ^ ((A >> 13) | (A << 19)) ^ ((A >> 22) | (A << 10))) + ((A & B) | (C & (A | B))); \
D += temp1; \
H = temp1 + temp2; \
}

void sha256_starts(sha256_context *ctx)
{
    ctx->state[0] = 0x6A09E667;
    ctx->state[1] = 0xBB67AE85;
    ctx->state[2] = 0x3C6EF372;
    ctx->state[3] = 0xA54FF53A;
    ctx->state[4] = 0x510E527F;
    ctx->state[5] = 0x9B05688C;
    ctx->state[6] = 0x1F83D9AB;
    ctx->state[7] = 0x5BE0CD19;
}

void sha256_process(sha256_context *ctx, uint8 data[64])
{
    uint32 temp1, temp2, W[64];
    uint32 A, B, C, D, E, F, G, H;

	W[0] = (data[0] << 24) | (data[1] << 16) | (data[2] << 8) | (data[3]);
	W[1] = (data[4] << 24) | (data[5] << 16) | (data[6] << 8) | (data[7]);
	W[2] = (data[8] << 24) | (data[9] << 16) | (data[10] << 8) | (data[11]);
	W[3] = (data[12] << 24) | (data[13] << 16) | (data[14] << 8) | (data[15]);
	W[4] = (data[16] << 24) | (data[17] << 16) | (data[18] << 8) | (data[19]);
	W[5] = (data[20] << 24) | (data[21] << 16) | (data[22] << 8) | (data[23]);
	W[6] = (data[24] << 24) | (data[25] << 16) | (data[26] << 8) | (data[27]);
	W[7] = (data[28] << 24) | (data[29] << 16) | (data[30] << 8) | (data[31]);
	W[8] = (data[32] << 24) | (data[33] << 16) | (data[34] << 8) | (data[35]);
	W[9] = (data[36] << 24) | (data[37] << 16) | (data[38] << 8) | (data[39]);
	W[10] = (data[40] << 24) | (data[41] << 16) | (data[42] << 8) | (data[43]);
	W[11] = (data[44] << 24) | (data[45] << 16) | (data[46] << 8) | (data[47]);
	W[12] = (data[48] << 24) | (data[49] << 16) | (data[50] << 8) | (data[51]);
	W[13] = (data[52] << 24) | (data[53] << 16) | (data[54] << 8) | (data[55]);
	W[14] = (data[56] << 24) | (data[57] << 16) | (data[58] << 8) | (data[59]);
	W[15] = (data[60] << 24) | (data[61] << 16) | (data[62] << 8) | (data[63]);

    A = ctx->state[0];
    B = ctx->state[1];
    C = ctx->state[2];
    D = ctx->state[3];
    E = ctx->state[4];
    F = ctx->state[5];
    G = ctx->state[6];
    H = ctx->state[7];

    P(A, B, C, D, E, F, G, H, W[ 0], 0x428A2F98);
    P(H, A, B, C, D, E, F, G, W[ 1], 0x71374491);
    P(G, H, A, B, C, D, E, F, W[ 2], 0xB5C0FBCF);
    P(F, G, H, A, B, C, D, E, W[ 3], 0xE9B5DBA5);
    P(E, F, G, H, A, B, C, D, W[ 4], 0x3956C25B);
    P(D, E, F, G, H, A, B, C, W[ 5], 0x59F111F1);
    P(C, D, E, F, G, H, A, B, W[ 6], 0x923F82A4);
    P(B, C, D, E, F, G, H, A, W[ 7], 0xAB1C5ED5);
    P(A, B, C, D, E, F, G, H, W[ 8], 0xD807AA98);
    P(H, A, B, C, D, E, F, G, W[ 9], 0x12835B01);
    P(G, H, A, B, C, D, E, F, W[10], 0x243185BE);
    P(F, G, H, A, B, C, D, E, W[11], 0x550C7DC3);
    P(E, F, G, H, A, B, C, D, W[12], 0x72BE5D74);
    P(D, E, F, G, H, A, B, C, W[13], 0x80DEB1FE);
    P(C, D, E, F, G, H, A, B, W[14], 0x9BDC06A7);
    P(B, C, D, E, F, G, H, A, W[15], 0xC19BF174);

	W[16] = ((SHR(W[14], 17) | (W[14] << 15)) ^ (SHR(W[14], 19) | (W[14] << 13)) ^ SHR(W[14], 10)) + W[9] + ((SHR(W[1], 7) | (W[1] << 25)) ^ (SHR(W[1], 18) | (W[1] << 14)) ^ SHR(W[1], 3)) + W[0];
	W[17] = ((SHR(W[15], 17) | (W[15] << 15)) ^ (SHR(W[15], 19) | (W[15] << 13)) ^ SHR(W[15], 10)) + W[10] + ((SHR(W[2], 7) | (W[2] << 25)) ^ (SHR(W[2], 18) | (W[2] << 14)) ^ SHR(W[2], 3)) + W[1];
	W[18] = ((SHR(W[16], 17) | (W[16] << 15)) ^ (SHR(W[16], 19) | (W[16] << 13)) ^ SHR(W[16], 10)) + W[11] + ((SHR(W[3], 7) | (W[3] << 25)) ^ (SHR(W[3], 18) | (W[3] << 14)) ^ SHR(W[3], 3)) + W[2];
	W[19] = ((SHR(W[17], 17) | (W[17] << 15)) ^ (SHR(W[17], 19) | (W[17] << 13)) ^ SHR(W[17], 10)) + W[12] + ((SHR(W[4], 7) | (W[4] << 25)) ^ (SHR(W[4], 18) | (W[4] << 14)) ^ SHR(W[4], 3)) + W[3];
	W[20] = ((SHR(W[18], 17) | (W[18] << 15)) ^ (SHR(W[18], 19) | (W[18] << 13)) ^ SHR(W[18], 10)) + W[13] + ((SHR(W[5], 7) | (W[5] << 25)) ^ (SHR(W[5], 18) | (W[5] << 14)) ^ SHR(W[5], 3)) + W[4];
	W[21] = ((SHR(W[19], 17) | (W[19] << 15)) ^ (SHR(W[19], 19) | (W[19] << 13)) ^ SHR(W[19], 10)) + W[14] + ((SHR(W[6], 7) | (W[6] << 25)) ^ (SHR(W[6], 18) | (W[6] << 14)) ^ SHR(W[6], 3)) + W[5];
	W[22] = ((SHR(W[20], 17) | (W[20] << 15)) ^ (SHR(W[20], 19) | (W[20] << 13)) ^ SHR(W[20], 10)) + W[15] + ((SHR(W[7], 7) | (W[7] << 25)) ^ (SHR(W[7], 18) | (W[7] << 14)) ^ SHR(W[7], 3)) + W[6];
	W[23] = ((SHR(W[21], 17) | (W[21] << 15)) ^ (SHR(W[21], 19) | (W[21] << 13)) ^ SHR(W[21], 10)) + W[16] + ((SHR(W[8], 7) | (W[8] << 25)) ^ (SHR(W[8], 18) | (W[8] << 14)) ^ SHR(W[8], 3)) + W[7];
	W[24] = ((SHR(W[22], 17) | (W[22] << 15)) ^ (SHR(W[22], 19) | (W[22] << 13)) ^ SHR(W[22], 10)) + W[17] + ((SHR(W[9], 7) | (W[9] << 25)) ^ (SHR(W[9], 18) | (W[9] << 14)) ^ SHR(W[9], 3)) + W[8];
	W[25] = ((SHR(W[23], 17) | (W[23] << 15)) ^ (SHR(W[23], 19) | (W[23] << 13)) ^ SHR(W[23], 10)) + W[18] + ((SHR(W[10], 7) | (W[10] << 25)) ^ (SHR(W[10], 18) | (W[10] << 14)) ^ SHR(W[10], 3)) + W[9];
	W[26] = ((SHR(W[24], 17) | (W[24] << 15)) ^ (SHR(W[24], 19) | (W[24] << 13)) ^ SHR(W[24], 10)) + W[19] + ((SHR(W[11], 7) | (W[11] << 25)) ^ (SHR(W[11], 18) | (W[11] << 14)) ^ SHR(W[11], 3)) + W[10];
	W[27] = ((SHR(W[25], 17) | (W[25] << 15)) ^ (SHR(W[25], 19) | (W[25] << 13)) ^ SHR(W[25], 10)) + W[20] + ((SHR(W[12], 7) | (W[12] << 25)) ^ (SHR(W[12], 18) | (W[12] << 14)) ^ SHR(W[12], 3)) + W[11];
	W[28] = ((SHR(W[26], 17) | (W[26] << 15)) ^ (SHR(W[26], 19) | (W[26] << 13)) ^ SHR(W[26], 10)) + W[21] + ((SHR(W[13], 7) | (W[13] << 25)) ^ (SHR(W[13], 18) | (W[13] << 14)) ^ SHR(W[13], 3)) + W[12];
	W[29] = ((SHR(W[27], 17) | (W[27] << 15)) ^ (SHR(W[27], 19) | (W[27] << 13)) ^ SHR(W[27], 10)) + W[22] + ((SHR(W[14], 7) | (W[14] << 25)) ^ (SHR(W[14], 18) | (W[14] << 14)) ^ SHR(W[14], 3)) + W[13];
	W[30] = ((SHR(W[28], 17) | (W[28] << 15)) ^ (SHR(W[28], 19) | (W[28] << 13)) ^ SHR(W[28], 10)) + W[23] + ((SHR(W[15], 7) | (W[15] << 25)) ^ (SHR(W[15], 18) | (W[15] << 14)) ^ SHR(W[15], 3)) + W[14];
	W[31] = ((SHR(W[29], 17) | (W[29] << 15)) ^ (SHR(W[29], 19) | (W[29] << 13)) ^ SHR(W[29], 10)) + W[24] + ((SHR(W[16], 7) | (W[16] << 25)) ^ (SHR(W[16], 18) | (W[16] << 14)) ^ SHR(W[16], 3)) + W[15];
	W[32] = ((SHR(W[30], 17) | (W[30] << 15)) ^ (SHR(W[30], 19) | (W[30] << 13)) ^ SHR(W[30], 10)) + W[25] + ((SHR(W[17], 7) | (W[17] << 25)) ^ (SHR(W[17], 18) | (W[17] << 14)) ^ SHR(W[17], 3)) + W[16];
	W[33] = ((SHR(W[31], 17) | (W[31] << 15)) ^ (SHR(W[31], 19) | (W[31] << 13)) ^ SHR(W[31], 10)) + W[26] + ((SHR(W[18], 7) | (W[18] << 25)) ^ (SHR(W[18], 18) | (W[18] << 14)) ^ SHR(W[18], 3)) + W[17];
	W[34] = ((SHR(W[32], 17) | (W[32] << 15)) ^ (SHR(W[32], 19) | (W[32] << 13)) ^ SHR(W[32], 10)) + W[27] + ((SHR(W[19], 7) | (W[19] << 25)) ^ (SHR(W[19], 18) | (W[19] << 14)) ^ SHR(W[19], 3)) + W[18];
	W[35] = ((SHR(W[33], 17) | (W[33] << 15)) ^ (SHR(W[33], 19) | (W[33] << 13)) ^ SHR(W[33], 10)) + W[28] + ((SHR(W[20], 7) | (W[20] << 25)) ^ (SHR(W[20], 18) | (W[20] << 14)) ^ SHR(W[20], 3)) + W[19];
	W[36] = ((SHR(W[34], 17) | (W[34] << 15)) ^ (SHR(W[34], 19) | (W[34] << 13)) ^ SHR(W[34], 10)) + W[29] + ((SHR(W[21], 7) | (W[21] << 25)) ^ (SHR(W[21], 18) | (W[21] << 14)) ^ SHR(W[21], 3)) + W[20];
	W[37] = ((SHR(W[35], 17) | (W[35] << 15)) ^ (SHR(W[35], 19) | (W[35] << 13)) ^ SHR(W[35], 10)) + W[30] + ((SHR(W[22], 7) | (W[22] << 25)) ^ (SHR(W[22], 18) | (W[22] << 14)) ^ SHR(W[22], 3)) + W[21];
	W[38] = ((SHR(W[36], 17) | (W[36] << 15)) ^ (SHR(W[36], 19) | (W[36] << 13)) ^ SHR(W[36], 10)) + W[31] + ((SHR(W[23], 7) | (W[23] << 25)) ^ (SHR(W[23], 18) | (W[23] << 14)) ^ SHR(W[23], 3)) + W[22];
	W[39] = ((SHR(W[37], 17) | (W[37] << 15)) ^ (SHR(W[37], 19) | (W[37] << 13)) ^ SHR(W[37], 10)) + W[32] + ((SHR(W[24], 7) | (W[24] << 25)) ^ (SHR(W[24], 18) | (W[24] << 14)) ^ SHR(W[24], 3)) + W[23];
	W[40] = ((SHR(W[38], 17) | (W[38] << 15)) ^ (SHR(W[38], 19) | (W[38] << 13)) ^ SHR(W[38], 10)) + W[33] + ((SHR(W[25], 7) | (W[25] << 25)) ^ (SHR(W[25], 18) | (W[25] << 14)) ^ SHR(W[25], 3)) + W[24];
	W[41] = ((SHR(W[39], 17) | (W[39] << 15)) ^ (SHR(W[39], 19) | (W[39] << 13)) ^ SHR(W[39], 10)) + W[34] + ((SHR(W[26], 7) | (W[26] << 25)) ^ (SHR(W[26], 18) | (W[26] << 14)) ^ SHR(W[26], 3)) + W[25];
	W[42] = ((SHR(W[40], 17) | (W[40] << 15)) ^ (SHR(W[40], 19) | (W[40] << 13)) ^ SHR(W[40], 10)) + W[35] + ((SHR(W[27], 7) | (W[27] << 25)) ^ (SHR(W[27], 18) | (W[27] << 14)) ^ SHR(W[27], 3)) + W[26];
	W[43] = ((SHR(W[41], 17) | (W[41] << 15)) ^ (SHR(W[41], 19) | (W[41] << 13)) ^ SHR(W[41], 10)) + W[36] + ((SHR(W[28], 7) | (W[28] << 25)) ^ (SHR(W[28], 18) | (W[28] << 14)) ^ SHR(W[28], 3)) + W[27];
	W[44] = ((SHR(W[42], 17) | (W[42] << 15)) ^ (SHR(W[42], 19) | (W[42] << 13)) ^ SHR(W[42], 10)) + W[37] + ((SHR(W[29], 7) | (W[29] << 25)) ^ (SHR(W[29], 18) | (W[29] << 14)) ^ SHR(W[29], 3)) + W[28];
	W[45] = ((SHR(W[43], 17) | (W[43] << 15)) ^ (SHR(W[43], 19) | (W[43] << 13)) ^ SHR(W[43], 10)) + W[38] + ((SHR(W[30], 7) | (W[30] << 25)) ^ (SHR(W[30], 18) | (W[30] << 14)) ^ SHR(W[30], 3)) + W[29];
	W[46] = ((SHR(W[44], 17) | (W[44] << 15)) ^ (SHR(W[44], 19) | (W[44] << 13)) ^ SHR(W[44], 10)) + W[39] + ((SHR(W[31], 7) | (W[31] << 25)) ^ (SHR(W[31], 18) | (W[31] << 14)) ^ SHR(W[31], 3)) + W[30];
	W[47] = ((SHR(W[45], 17) | (W[45] << 15)) ^ (SHR(W[45], 19) | (W[45] << 13)) ^ SHR(W[45], 10)) + W[40] + ((SHR(W[32], 7) | (W[32] << 25)) ^ (SHR(W[32], 18) | (W[32] << 14)) ^ SHR(W[32], 3)) + W[31];
	W[48] = ((SHR(W[46], 17) | (W[46] << 15)) ^ (SHR(W[46], 19) | (W[46] << 13)) ^ SHR(W[46], 10)) + W[41] + ((SHR(W[33], 7) | (W[33] << 25)) ^ (SHR(W[33], 18) | (W[33] << 14)) ^ SHR(W[33], 3)) + W[32];
	W[49] = ((SHR(W[47], 17) | (W[47] << 15)) ^ (SHR(W[47], 19) | (W[47] << 13)) ^ SHR(W[47], 10)) + W[42] + ((SHR(W[34], 7) | (W[34] << 25)) ^ (SHR(W[34], 18) | (W[34] << 14)) ^ SHR(W[34], 3)) + W[33];
	W[50] = ((SHR(W[48], 17) | (W[48] << 15)) ^ (SHR(W[48], 19) | (W[48] << 13)) ^ SHR(W[48], 10)) + W[43] + ((SHR(W[35], 7) | (W[35] << 25)) ^ (SHR(W[35], 18) | (W[35] << 14)) ^ SHR(W[35], 3)) + W[34];
	W[51] = ((SHR(W[49], 17) | (W[49] << 15)) ^ (SHR(W[49], 19) | (W[49] << 13)) ^ SHR(W[49], 10)) + W[44] + ((SHR(W[36], 7) | (W[36] << 25)) ^ (SHR(W[36], 18) | (W[36] << 14)) ^ SHR(W[36], 3)) + W[35];
	W[52] = ((SHR(W[50], 17) | (W[50] << 15)) ^ (SHR(W[50], 19) | (W[50] << 13)) ^ SHR(W[50], 10)) + W[45] + ((SHR(W[37], 7) | (W[37] << 25)) ^ (SHR(W[37], 18) | (W[37] << 14)) ^ SHR(W[37], 3)) + W[36];
	W[53] = ((SHR(W[51], 17) | (W[51] << 15)) ^ (SHR(W[51], 19) | (W[51] << 13)) ^ SHR(W[51], 10)) + W[46] + ((SHR(W[38], 7) | (W[38] << 25)) ^ (SHR(W[38], 18) | (W[38] << 14)) ^ SHR(W[38], 3)) + W[37];
	W[54] = ((SHR(W[52], 17) | (W[52] << 15)) ^ (SHR(W[52], 19) | (W[52] << 13)) ^ SHR(W[52], 10)) + W[47] + ((SHR(W[39], 7) | (W[39] << 25)) ^ (SHR(W[39], 18) | (W[39] << 14)) ^ SHR(W[39], 3)) + W[38];
	W[55] = ((SHR(W[53], 17) | (W[53] << 15)) ^ (SHR(W[53], 19) | (W[53] << 13)) ^ SHR(W[53], 10)) + W[48] + ((SHR(W[40], 7) | (W[40] << 25)) ^ (SHR(W[40], 18) | (W[40] << 14)) ^ SHR(W[40], 3)) + W[39];
	W[56] = ((SHR(W[54], 17) | (W[54] << 15)) ^ (SHR(W[54], 19) | (W[54] << 13)) ^ SHR(W[54], 10)) + W[49] + ((SHR(W[41], 7) | (W[41] << 25)) ^ (SHR(W[41], 18) | (W[41] << 14)) ^ SHR(W[41], 3)) + W[40];
	W[57] = ((SHR(W[55], 17) | (W[55] << 15)) ^ (SHR(W[55], 19) | (W[55] << 13)) ^ SHR(W[55], 10)) + W[50] + ((SHR(W[42], 7) | (W[42] << 25)) ^ (SHR(W[42], 18) | (W[42] << 14)) ^ SHR(W[42], 3)) + W[41];
	W[58] = ((SHR(W[56], 17) | (W[56] << 15)) ^ (SHR(W[56], 19) | (W[56] << 13)) ^ SHR(W[56], 10)) + W[51] + ((SHR(W[43], 7) | (W[43] << 25)) ^ (SHR(W[43], 18) | (W[43] << 14)) ^ SHR(W[43], 3)) + W[42];
	W[59] = ((SHR(W[57], 17) | (W[57] << 15)) ^ (SHR(W[57], 19) | (W[57] << 13)) ^ SHR(W[57], 10)) + W[52] + ((SHR(W[44], 7) | (W[44] << 25)) ^ (SHR(W[44], 18) | (W[44] << 14)) ^ SHR(W[44], 3)) + W[43];
	W[60] = ((SHR(W[58], 17) | (W[58] << 15)) ^ (SHR(W[58], 19) | (W[58] << 13)) ^ SHR(W[58], 10)) + W[53] + ((SHR(W[45], 7) | (W[45] << 25)) ^ (SHR(W[45], 18) | (W[45] << 14)) ^ SHR(W[45], 3)) + W[44];
	W[61] = ((SHR(W[59], 17) | (W[59] << 15)) ^ (SHR(W[59], 19) | (W[59] << 13)) ^ SHR(W[59], 10)) + W[54] + ((SHR(W[46], 7) | (W[46] << 25)) ^ (SHR(W[46], 18) | (W[46] << 14)) ^ SHR(W[46], 3)) + W[45];
	W[62] = ((SHR(W[60], 17) | (W[60] << 15)) ^ (SHR(W[60], 19) | (W[60] << 13)) ^ SHR(W[60], 10)) + W[55] + ((SHR(W[47], 7) | (W[47] << 25)) ^ (SHR(W[47], 18) | (W[47] << 14)) ^ SHR(W[47], 3)) + W[46];
	W[63] = ((SHR(W[61], 17) | (W[61] << 15)) ^ (SHR(W[61], 19) | (W[61] << 13)) ^ SHR(W[61], 10)) + W[56] + ((SHR(W[48], 7) | (W[48] << 25)) ^ (SHR(W[48], 18) | (W[48] << 14)) ^ SHR(W[48], 3)) + W[47];
	
	P(A, B, C, D, E, F, G, H, W[16], 0xE49B69C1);
    P(H, A, B, C, D, E, F, G, W[17], 0xEFBE4786);
    P(G, H, A, B, C, D, E, F, W[18], 0x0FC19DC6);
    P(F, G, H, A, B, C, D, E, W[19], 0x240CA1CC);
    P(E, F, G, H, A, B, C, D, W[20], 0x2DE92C6F);
    P(D, E, F, G, H, A, B, C, W[21], 0x4A7484AA);
    P(C, D, E, F, G, H, A, B, W[22], 0x5CB0A9DC);
    P(B, C, D, E, F, G, H, A, W[23], 0x76F988DA);
    P(A, B, C, D, E, F, G, H, W[24], 0x983E5152);
    P(H, A, B, C, D, E, F, G, W[25], 0xA831C66D);
    P(G, H, A, B, C, D, E, F, W[26], 0xB00327C8);
    P(F, G, H, A, B, C, D, E, W[27], 0xBF597FC7);
    P(E, F, G, H, A, B, C, D, W[28], 0xC6E00BF3);
    P(D, E, F, G, H, A, B, C, W[29], 0xD5A79147);
    P(C, D, E, F, G, H, A, B, W[30], 0x06CA6351);
    P(B, C, D, E, F, G, H, A, W[31], 0x14292967);
    P(A, B, C, D, E, F, G, H, W[32], 0x27B70A85);
    P(H, A, B, C, D, E, F, G, W[33], 0x2E1B2138);
    P(G, H, A, B, C, D, E, F, W[34], 0x4D2C6DFC);
    P(F, G, H, A, B, C, D, E, W[35], 0x53380D13);
    P(E, F, G, H, A, B, C, D, W[36], 0x650A7354);
    P(D, E, F, G, H, A, B, C, W[37], 0x766A0ABB);
    P(C, D, E, F, G, H, A, B, W[38], 0x81C2C92E);
    P(B, C, D, E, F, G, H, A, W[39], 0x92722C85);
    P(A, B, C, D, E, F, G, H, W[40], 0xA2BFE8A1);
    P(H, A, B, C, D, E, F, G, W[41], 0xA81A664B);
    P(G, H, A, B, C, D, E, F, W[42], 0xC24B8B70);
    P(F, G, H, A, B, C, D, E, W[43], 0xC76C51A3);
    P(E, F, G, H, A, B, C, D, W[44], 0xD192E819);
    P(D, E, F, G, H, A, B, C, W[45], 0xD6990624);
    P(C, D, E, F, G, H, A, B, W[46], 0xF40E3585);
    P(B, C, D, E, F, G, H, A, W[47], 0x106AA070);
    P(A, B, C, D, E, F, G, H, W[48], 0x19A4C116);
    P(H, A, B, C, D, E, F, G, W[49], 0x1E376C08);
    P(G, H, A, B, C, D, E, F, W[50], 0x2748774C);
    P(F, G, H, A, B, C, D, E, W[51], 0x34B0BCB5);
    P(E, F, G, H, A, B, C, D, W[52], 0x391C0CB3);
    P(D, E, F, G, H, A, B, C, W[53], 0x4ED8AA4A);
    P(C, D, E, F, G, H, A, B, W[54], 0x5B9CCA4F);
    P(B, C, D, E, F, G, H, A, W[55], 0x682E6FF3);
    P(A, B, C, D, E, F, G, H, W[56], 0x748F82EE);
    P(H, A, B, C, D, E, F, G, W[57], 0x78A5636F);
    P(G, H, A, B, C, D, E, F, W[58], 0x84C87814);
    P(F, G, H, A, B, C, D, E, W[59], 0x8CC70208);
    P(E, F, G, H, A, B, C, D, W[60], 0x90BEFFFA);
    P(D, E, F, G, H, A, B, C, W[61], 0xA4506CEB);
    P(C, D, E, F, G, H, A, B, W[62], 0xBEF9A3F7);
    P(B, C, D, E, F, G, H, A, W[63], 0xC67178F2);

    ctx->state[0] += A;
    ctx->state[1] += B;
    ctx->state[2] += C;
    ctx->state[3] += D;
    ctx->state[4] += E;
    ctx->state[5] += F;
    ctx->state[6] += G;
    ctx->state[7] += H;
}

void sha256_process_in_finish(sha256_context *ctx, uint8 data[64])
{
    uint32 temp1;
    uint32 A, B, C, D, E, F, G, H;
	
    A = ctx->state[0];
    B = ctx->state[1];
    C = ctx->state[2];
    D = ctx->state[3];
    E = ctx->state[4];
    F = ctx->state[5];
    G = ctx->state[6];
    H = ctx->state[7];

	temp1 = H + (((E >> 6) | (E << 26)) ^ ((E >> 11) | (E << 21)) ^ ((E >> 25) | (E << 7))) + (G ^ (E & (F ^ G))) + 0xC28A2F98;
	D += temp1;
	H = temp1 + (((A >> 2) | (A << 30)) ^ ((A >> 13) | (A << 19)) ^ ((A >> 22) | (A << 10))) + ((A & B) | (C & (A | B)));

	temp1 = G + (((D >> 6) | (D << 26)) ^ ((D >> 11) | (D << 21)) ^ ((D >> 25) | (D << 7))) + (F ^ (D & (E ^ F))) + 0x71374491;
	C += temp1;
	G = temp1 + (((H >> 2) | (H << 30)) ^ ((H >> 13) | (H << 19)) ^ ((H >> 22) | (H << 10))) + ((H & A) | (B & (H | A)));

	temp1 = F + (((C >> 6) | (C << 26)) ^ ((C >> 11) | (C << 21)) ^ ((C >> 25) | (C << 7))) + (E ^ (C & (D ^ E))) + 0xB5C0FBCF;
	B += temp1;
	F = temp1 + (((G >> 2) | (G << 30)) ^ ((G >> 13) | (G << 19)) ^ ((G >> 22) | (G << 10))) + ((G & H) | (A & (G | H)));

	temp1 = E + (((B >> 6) | (B << 26)) ^ ((B >> 11) | (B << 21)) ^ ((B >> 25) | (B << 7))) + (D ^ (B & (C ^ D))) + 0xE9B5DBA5;
	A += temp1;
	E = temp1 + (((F >> 2) | (F << 30)) ^ ((F >> 13) | (F << 19)) ^ ((F >> 22) | (F << 10))) + ((F & G) | (H & (F | G)));

	temp1 = D + (((A >> 6) | (A << 26)) ^ ((A >> 11) | (A << 21)) ^ ((A >> 25) | (A << 7))) + (C ^ (A & (B ^ C))) + 0x3956C25B;
	H += temp1;
	D = temp1 + (((E >> 2) | (E << 30)) ^ ((E >> 13) | (E << 19)) ^ ((E >> 22) | (E << 10))) + ((E & F) | (G & (E | F)));

	temp1 = C + (((H >> 6) | (H << 26)) ^ ((H >> 11) | (H << 21)) ^ ((H >> 25) | (H << 7))) + (B ^ (H & (A ^ B))) + 0x59F111F1;
	G += temp1;
	C = temp1 + (((D >> 2) | (D << 30)) ^ ((D >> 13) | (D << 19)) ^ ((D >> 22) | (D << 10))) + ((D & E) | (F & (D | E)));

	temp1 = B + (((G >> 6) | (G << 26)) ^ ((G >> 11) | (G << 21)) ^ ((G >> 25) | (G << 7))) + (A ^ (G & (H ^ A))) + 0x923F82A4;
	F += temp1;
	B = temp1 + (((C >> 2) | (C << 30)) ^ ((C >> 13) | (C << 19)) ^ ((C >> 22) | (C << 10))) + ((C & D) | (E & (C | D)));

	temp1 = A + (((F >> 6) | (F << 26)) ^ ((F >> 11) | (F << 21)) ^ ((F >> 25) | (F << 7))) + (H ^ (F & (G ^ H))) + 0xAB1C5ED5;
	E += temp1;
	A = temp1 + (((B >> 2) | (B << 30)) ^ ((B >> 13) | (B << 19)) ^ ((B >> 22) | (B << 10))) + ((B & C) | (D & (B | C)));

	temp1 = H + (((E >> 6) | (E << 26)) ^ ((E >> 11) | (E << 21)) ^ ((E >> 25) | (E << 7))) + (G ^ (E & (F ^ G))) + 0xD807AA98;
	D += temp1;
	H = temp1 + (((A >> 2) | (A << 30)) ^ ((A >> 13) | (A << 19)) ^ ((A >> 22) | (A << 10))) + ((A & B) | (C & (A | B)));

	temp1 = G + (((D >> 6) | (D << 26)) ^ ((D >> 11) | (D << 21)) ^ ((D >> 25) | (D << 7))) + (F ^ (D & (E ^ F))) + 0x12835B01;
	C += temp1;
	G = temp1 + (((H >> 2) | (H << 30)) ^ ((H >> 13) | (H << 19)) ^ ((H >> 22) | (H << 10))) + ((H & A) | (B & (H | A)));

	temp1 = F + (((C >> 6) | (C << 26)) ^ ((C >> 11) | (C << 21)) ^ ((C >> 25) | (C << 7))) + (E ^ (C & (D ^ E))) + 0x243185BE;
	B += temp1;
	F = temp1 + (((G >> 2) | (G << 30)) ^ ((G >> 13) | (G << 19)) ^ ((G >> 22) | (G << 10))) + ((G & H) | (A & (G | H)));

	temp1 = E + (((B >> 6) | (B << 26)) ^ ((B >> 11) | (B << 21)) ^ ((B >> 25) | (B << 7))) + (D ^ (B & (C ^ D))) + 0x550C7DC3;
	A += temp1;
	E = temp1 + (((F >> 2) | (F << 30)) ^ ((F >> 13) | (F << 19)) ^ ((F >> 22) | (F << 10))) + ((F & G) | (H & (F | G)));

	temp1 = D + (((A >> 6) | (A << 26)) ^ ((A >> 11) | (A << 21)) ^ ((A >> 25) | (A << 7))) + (C ^ (A & (B ^ C))) + 0x72BE5D74;
	H += temp1;
	D = temp1 + (((E >> 2) | (E << 30)) ^ ((E >> 13) | (E << 19)) ^ ((E >> 22) | (E << 10))) + ((E & F) | (G & (E | F)));

	temp1 = C + (((H >> 6) | (H << 26)) ^ ((H >> 11) | (H << 21)) ^ ((H >> 25) | (H << 7))) + (B ^ (H & (A ^ B))) + 0x80DEB1FE;
	G += temp1;
	C = temp1 + (((D >> 2) | (D << 30)) ^ ((D >> 13) | (D << 19)) ^ ((D >> 22) | (D << 10))) + ((D & E) | (F & (D | E)));

	temp1 = B + (((G >> 6) | (G << 26)) ^ ((G >> 11) | (G << 21)) ^ ((G >> 25) | (G << 7))) + (A ^ (G & (H ^ A))) + 0x9BDC06A7;
	F += temp1;
	B = temp1 + (((C >> 2) | (C << 30)) ^ ((C >> 13) | (C << 19)) ^ ((C >> 22) | (C << 10))) + ((C & D) | (E & (C | D)));

	temp1 = A + (((F >> 6) | (F << 26)) ^ ((F >> 11) | (F << 21)) ^ ((F >> 25) | (F << 7))) + (H ^ (F & (G ^ H))) + 0xC19BF374;
	E += temp1;
	A = temp1 + (((B >> 2) | (B << 30)) ^ ((B >> 13) | (B << 19)) ^ ((B >> 22) | (B << 10))) + ((B & C) | (D & (B | C)));

	/** 16 - 64 **/
	temp1 = H + (((E >> 6) | (E << 26)) ^ ((E >> 11) | (E << 21)) ^ ((E >> 25) | (E << 7))) + (G ^ (E & (F ^ G))) + 0x649b69c1;
	D += temp1;
	H = temp1 + (((A >> 2) | (A << 30)) ^ ((A >> 13) | (A << 19)) ^ ((A >> 22) | (A << 10))) + ((A & B) | (C & (A | B)));

	temp1 = G + (((D >> 6) | (D << 26)) ^ ((D >> 11) | (D << 21)) ^ ((D >> 25) | (D << 7))) + (F ^ (D & (E ^ F))) + 0xf0fe4786;
	C += temp1;
	G = temp1 + (((H >> 2) | (H << 30)) ^ ((H >> 13) | (H << 19)) ^ ((H >> 22) | (H << 10))) + ((H & A) | (B & (H | A)));

	temp1 = F + (((C >> 6) | (C << 26)) ^ ((C >> 11) | (C << 21)) ^ ((C >> 25) | (C << 7))) + (E ^ (C & (D ^ E))) + 0xfe1edc6;
	B += temp1;
	F = temp1 + (((G >> 2) | (G << 30)) ^ ((G >> 13) | (G << 19)) ^ ((G >> 22) | (G << 10))) + ((G & H) | (A & (G | H)));
	
	temp1 = E + (((B >> 6) | (B << 26)) ^ ((B >> 11) | (B << 21)) ^ ((B >> 25) | (B << 7))) + (D ^ (B & (C ^ D))) + 0x240cf254;
	A += temp1;
	E = temp1 + (((F >> 2) | (F << 30)) ^ ((F >> 13) | (F << 19)) ^ ((F >> 22) | (F << 10))) + ((F & G) | (H & (F | G)));
	
	temp1 = D + (((A >> 6) | (A << 26)) ^ ((A >> 11) | (A << 21)) ^ ((A >> 25) | (A << 7))) + (C ^ (A & (B ^ C))) + 0x4fe9346f;
	H += temp1;
	D = temp1 + (((E >> 2) | (E << 30)) ^ ((E >> 13) | (E << 19)) ^ ((E >> 22) | (E << 10))) + ((E & F) | (G & (E | F)));

	temp1 = C + (((H >> 6) | (H << 26)) ^ ((H >> 11) | (H << 21)) ^ ((H >> 25) | (H << 7))) + (B ^ (H & (A ^ B))) + 0x6cc984be;
	G += temp1;
	C = temp1 + (((D >> 2) | (D << 30)) ^ ((D >> 13) | (D << 19)) ^ ((D >> 22) | (D << 10))) + ((D & E) | (F & (D | E)));

	temp1 = B + (((G >> 6) | (G << 26)) ^ ((G >> 11) | (G << 21)) ^ ((G >> 25) | (G << 7))) + (A ^ (G & (H ^ A))) + 0x61b9411e;
	F += temp1;
	B = temp1 + (((C >> 2) | (C << 30)) ^ ((C >> 13) | (C << 19)) ^ ((C >> 22) | (C << 10))) + ((C & D) | (E & (C | D)));

	temp1 = A + (((F >> 6) | (F << 26)) ^ ((F >> 11) | (F << 21)) ^ ((F >> 25) | (F << 7))) + (H ^ (F & (G ^ H))) + 0x16f988fa;
	E += temp1;
	A = temp1 + (((B >> 2) | (B << 30)) ^ ((B >> 13) | (B << 19)) ^ ((B >> 22) | (B << 10))) + ((B & C) | (D & (B | C)));

	temp1 = H + (((E >> 6) | (E << 26)) ^ ((E >> 11) | (E << 21)) ^ ((E >> 25) | (E << 7))) + (G ^ (E & (F ^ G))) + 0xf2c65152;
	D += temp1;
	H = temp1 + (((A >> 2) | (A << 30)) ^ ((A >> 13) | (A << 19)) ^ ((A >> 22) | (A << 10))) + ((A & B) | (C & (A | B)));

	temp1 = G + (((D >> 6) | (D << 26)) ^ ((D >> 11) | (D << 21)) ^ ((D >> 25) | (D << 7))) + (F ^ (D & (E ^ F))) + 0xa88e5a6d;
	C += temp1;
	G = temp1 + (((H >> 2) | (H << 30)) ^ ((H >> 13) | (H << 19)) ^ ((H >> 22) | (H << 10))) + ((H & A) | (B & (H | A)));

	temp1 = F + (((C >> 6) | (C << 26)) ^ ((C >> 11) | (C << 21)) ^ ((C >> 25) | (C << 7))) + (E ^ (C & (D ^ E))) + 0xb019fc65;
	B += temp1;
	F = temp1 + (((G >> 2) | (G << 30)) ^ ((G >> 13) | (G << 19)) ^ ((G >> 22) | (G << 10))) + ((G & H) | (A & (G | H)));

	temp1 = E + (((B >> 6) | (B << 26)) ^ ((B >> 11) | (B << 21)) ^ ((B >> 25) | (B << 7))) + (D ^ (B & (C ^ D))) + 0xb9d99ec7;
	A += temp1;
	E = temp1 + (((F >> 2) | (F << 30)) ^ ((F >> 13) | (F << 19)) ^ ((F >> 22) | (F << 10))) + ((F & G) | (H & (F | G)));

	temp1 = D + (((A >> 6) | (A << 26)) ^ ((A >> 11) | (A << 21)) ^ ((A >> 25) | (A << 7))) + (C ^ (A & (B ^ C))) + 0x9a1231c3;
	H += temp1;
	D = temp1 + (((E >> 2) | (E << 30)) ^ ((E >> 13) | (E << 19)) ^ ((E >> 22) | (E << 10))) + ((E & F) | (G & (E | F)));

	temp1 = C + (((H >> 6) | (H << 26)) ^ ((H >> 11) | (H << 21)) ^ ((H >> 25) | (H << 7))) + (B ^ (H & (A ^ B))) + 0xe70eeaa0;
	G += temp1;
	C = temp1 + (((D >> 2) | (D << 30)) ^ ((D >> 13) | (D << 19)) ^ ((D >> 22) | (D << 10))) + ((D & E) | (F & (D | E)));

	temp1 = B + (((G >> 6) | (G << 26)) ^ ((G >> 11) | (G << 21)) ^ ((G >> 25) | (G << 7))) + (A ^ (G & (H ^ A))) - 0x24edcd5;
	F += temp1;
	B = temp1 + (((C >> 2) | (C << 30)) ^ ((C >> 13) | (C << 19)) ^ ((C >> 22) | (C << 10))) + ((C & D) | (E & (C | D)));

	temp1 = A + (((F >> 6) | (F << 26)) ^ ((F >> 11) | (F << 21)) ^ ((F >> 25) | (F << 7))) + (H ^ (F & (G ^ H))) - 0x38cac150;
	E += temp1;
	A = temp1 + (((B >> 2) | (B << 30)) ^ ((B >> 13) | (B << 19)) ^ ((B >> 22) | (B << 10))) + ((B & C) | (D & (B | C)));

	temp1 = H + (((E >> 6) | (E << 26)) ^ ((E >> 11) | (E << 21)) ^ ((E >> 25) | (E << 7))) + (G ^ (E & (F ^ G))) + 0x3069bad5;
	D += temp1;
	H = temp1 + (((A >> 2) | (A << 30)) ^ ((A >> 13) | (A << 19)) ^ ((A >> 22) | (A << 10))) + ((A & B) | (C & (A | B)));

	temp1 = G + (((D >> 6) | (D << 26)) ^ ((D >> 11) | (D << 21)) ^ ((D >> 25) | (D << 7))) + (F ^ (D & (E ^ F))) - 0x346892a1;
	C += temp1;
	G = temp1 + (((H >> 2) | (H << 30)) ^ ((H >> 13) | (H << 19)) ^ ((H >> 22) | (H << 10))) + ((H & A) | (B & (H | A)));

	temp1 = F + (((C >> 6) | (C << 26)) ^ ((C >> 11) | (C << 21)) ^ ((C >> 25) | (C << 7))) + (E ^ (C & (D ^ E))) + 0x5a0f118f;
	B += temp1;
	F = temp1 + (((G >> 2) | (G << 30)) ^ ((G >> 13) | (G << 19)) ^ ((G >> 22) | (G << 10))) + ((G & H) | (A & (G | H)));

	temp1 = E + (((B >> 6) | (B << 26)) ^ ((B >> 11) | (B << 21)) ^ ((B >> 25) | (B << 7))) + (D ^ (B & (C ^ D))) - 0x23e11103;
	A += temp1;
	E = temp1 + (((F >> 2) | (F << 30)) ^ ((F >> 13) | (F << 19)) ^ ((F >> 22) | (F << 10))) + ((F & G) | (H & (F | G)));

	temp1 = D + (((A >> 6) | (A << 26)) ^ ((A >> 11) | (A << 21)) ^ ((A >> 25) | (A << 7))) + (C ^ (A & (B ^ C))) + 0xa35b689;
	H += temp1;
	D = temp1 + (((E >> 2) | (E << 30)) ^ ((E >> 13) | (E << 19)) ^ ((E >> 22) | (E << 10))) + ((E & F) | (G & (E | F)));

	temp1 = C + (((H >> 6) | (H << 26)) ^ ((H >> 11) | (H << 21)) ^ ((H >> 25) | (H << 7))) + (B ^ (H & (A ^ B))) + 0xde0b7a04;
	G += temp1;
	C = temp1 + (((D >> 2) | (D << 30)) ^ ((D >> 13) | (D << 19)) ^ ((D >> 22) | (D << 10))) + ((D & E) | (F & (D | E)));

	temp1 = B + (((G >> 6) | (G << 26)) ^ ((G >> 11) | (G << 21)) ^ ((G >> 25) | (G << 7))) + (A ^ (G & (H ^ A))) + 0x58f4ca9d;
	F += temp1;
	B = temp1 + (((C >> 2) | (C << 30)) ^ ((C >> 13) | (C << 19)) ^ ((C >> 22) | (C << 10))) + ((C & D) | (E & (C | D)));

	temp1 = A + (((F >> 6) | (F << 26)) ^ ((F >> 11) | (F << 21)) ^ ((F >> 25) | (F << 7))) + (H ^ (F & (G ^ H))) + 0xe15d5b16;
	E += temp1;
	A = temp1 + (((B >> 2) | (B << 30)) ^ ((B >> 13) | (B << 19)) ^ ((B >> 22) | (B << 10))) + ((B & C) | (D & (B | C)));

	temp1 = H + (((E >> 6) | (E << 26)) ^ ((E >> 11) | (E << 21)) ^ ((E >> 25) | (E << 7))) + (G ^ (E & (F ^ G))) + 0x1007f3e86;
	D += temp1;
	H = temp1 + (((A >> 2) | (A << 30)) ^ ((A >> 13) | (A << 19)) ^ ((A >> 22) | (A << 10))) + ((A & B) | (C & (A | B)));

	temp1 = G + (((D >> 6) | (D << 26)) ^ ((D >> 11) | (D << 21)) ^ ((D >> 25) | (D << 7))) + (F ^ (D & (E ^ F))) + 0x37088980;
	C += temp1;
	G = temp1 + (((H >> 2) | (H << 30)) ^ ((H >> 13) | (H << 19)) ^ ((H >> 22) | (H << 10))) + ((H & A) | (B & (H | A)));

	temp1 = F + (((C >> 6) | (C << 26)) ^ ((C >> 11) | (C << 21)) ^ ((C >> 25) | (C << 7))) + (E ^ (C & (D ^ E))) + 0xa507ea32;
	B += temp1;
	F = temp1 + (((G >> 2) | (G << 30)) ^ ((G >> 13) | (G << 19)) ^ ((G >> 22) | (G << 10))) + ((G & H) | (A & (G | H)));

	temp1 = E + (((B >> 6) | (B << 26)) ^ ((B >> 11) | (B << 21)) ^ ((B >> 25) | (B << 7))) + (D ^ (B & (C ^ D))) + 0x6fab9537;
	A += temp1;
	E = temp1 + (((F >> 2) | (F << 30)) ^ ((F >> 13) | (F << 19)) ^ ((F >> 22) | (F << 10))) + ((F & G) | (H & (F | G)));

	temp1 = D + (((A >> 6) | (A << 26)) ^ ((A >> 11) | (A << 21)) ^ ((A >> 25) | (A << 7))) + (C ^ (A & (B ^ C))) + 0x117406110;
	H += temp1;
	D = temp1 + (((E >> 2) | (E << 30)) ^ ((E >> 13) | (E << 19)) ^ ((E >> 22) | (E << 10))) + ((E & F) | (G & (E | F)));

	temp1 = C + (((H >> 6) | (H << 26)) ^ ((H >> 11) | (H << 21)) ^ ((H >> 25) | (H << 7))) + (B ^ (H & (A ^ B))) + 0x10d8cd6f1;
	G += temp1;
	C = temp1 + (((D >> 2) | (D << 30)) ^ ((D >> 13) | (D << 19)) ^ ((D >> 22) | (D << 10))) + ((D & E) | (F & (D | E)));

	temp1 = B + (((G >> 6) | (G << 26)) ^ ((G >> 11) | (G << 21)) ^ ((G >> 25) | (G << 7))) + (A ^ (G & (H ^ A))) + 0xcdaa3b6d;
	F += temp1;
	B = temp1 + (((C >> 2) | (C << 30)) ^ ((C >> 13) | (C << 19)) ^ ((C >> 22) | (C << 10))) + ((C & D) | (E & (C | D)));

	temp1 = A + (((F >> 6) | (F << 26)) ^ ((F >> 11) | (F << 21)) ^ ((F >> 25) | (F << 7))) + (H ^ (F & (G ^ H))) - 0x3f4441c9;
	E += temp1;
	A = temp1 + (((B >> 2) | (B << 30)) ^ ((B >> 13) | (B << 19)) ^ ((B >> 22) | (B << 10))) + ((B & C) | (D & (B | C)));

	temp1 = H + (((E >> 6) | (E << 26)) ^ ((E >> 11) | (E << 21)) ^ ((E >> 25) | (E << 7))) + (G ^ (E & (F ^ G))) + 0x83613bda;
	D += temp1;
	H = temp1 + (((A >> 2) | (A << 30)) ^ ((A >> 13) | (A << 19)) ^ ((A >> 22) | (A << 10))) + ((A & B) | (C & (A | B)));

	temp1 = G + (((D >> 6) | (D << 26)) ^ ((D >> 11) | (D << 21)) ^ ((D >> 25) | (D << 7))) + (F ^ (D & (E ^ F))) - 0x24b75c9d;
	C += temp1;
	G = temp1 + (((H >> 2) | (H << 30)) ^ ((H >> 13) | (H << 19)) ^ ((H >> 22) | (H << 10))) + ((H & A) | (B & (H | A)));

	temp1 = F + (((C >> 6) | (C << 26)) ^ ((C >> 11) | (C << 21)) ^ ((C >> 25) | (C << 7))) + (E ^ (C & (D ^ E))) + 0xb02e931;
	B += temp1;
	F = temp1 + (((G >> 2) | (G << 30)) ^ ((G >> 13) | (G << 19)) ^ ((G >> 22) | (G << 10))) + ((G & H) | (A & (G | H)));

	temp1 = E + (((B >> 6) | (B << 26)) ^ ((B >> 11) | (B << 21)) ^ ((B >> 25) | (B << 7))) + (D ^ (B & (C ^ D))) + 0x6fd15ca7;
	A += temp1;
	E = temp1 + (((F >> 2) | (F << 30)) ^ ((F >> 13) | (F << 19)) ^ ((F >> 22) | (F << 10))) + ((F & G) | (H & (F | G)));

	temp1 = D + (((A >> 6) | (A << 26)) ^ ((A >> 11) | (A << 21)) ^ ((A >> 25) | (A << 7))) + (C ^ (A & (B ^ C))) + 0x521afaca;
	H += temp1;
	D = temp1 + (((E >> 2) | (E << 30)) ^ ((E >> 13) | (E << 19)) ^ ((E >> 22) | (E << 10))) + ((E & F) | (G & (E | F)));

	temp1 = C + (((H >> 6) | (H << 26)) ^ ((H >> 11) | (H << 21)) ^ ((H >> 25) | (H << 7))) + (B ^ (H & (A ^ B))) + 0x31338431;
	G += temp1;
	C = temp1 + (((D >> 2) | (D << 30)) ^ ((D >> 13) | (D << 19)) ^ ((D >> 22) | (D << 10))) + ((D & E) | (F & (D | E)));

	temp1 = B + (((G >> 6) | (G << 26)) ^ ((G >> 11) | (G << 21)) ^ ((G >> 25) | (G << 7))) + (A ^ (G & (H ^ A))) + 0x6ed41a95;
	F += temp1;
	B = temp1 + (((C >> 2) | (C << 30)) ^ ((C >> 13) | (C << 19)) ^ ((C >> 22) | (C << 10))) + ((C & D) | (E & (C | D)));

	temp1 = A + (((F >> 6) | (F << 26)) ^ ((F >> 11) | (F << 21)) ^ ((F >> 25) | (F << 7))) + (H ^ (F & (G ^ H))) + 0x6d437890;
	E += temp1;
	A = temp1 + (((B >> 2) | (B << 30)) ^ ((B >> 13) | (B << 19)) ^ ((B >> 22) | (B << 10))) + ((B & C) | (D & (B | C)));

	temp1 = H + (((E >> 6) | (E << 26)) ^ ((E >> 11) | (E << 21)) ^ ((E >> 25) | (E << 7))) + (G ^ (E & (F ^ G))) + 0xc39c91f2;
	D += temp1;
	H = temp1 + (((A >> 2) | (A << 30)) ^ ((A >> 13) | (A << 19)) ^ ((A >> 22) | (A << 10))) + ((A & B) | (C & (A | B)));

	temp1 = G + (((D >> 6) | (D << 26)) ^ ((D >> 11) | (D << 21)) ^ ((D >> 25) | (D << 7))) + (F ^ (D & (E ^ F))) + 0x9eccabbd;
	C += temp1;
	G = temp1 + (((H >> 2) | (H << 30)) ^ ((H >> 13) | (H << 19)) ^ ((H >> 22) | (H << 10))) + ((H & A) | (B & (H | A)));

	temp1 = F + (((C >> 6) | (C << 26)) ^ ((C >> 11) | (C << 21)) ^ ((C >> 25) | (C << 7))) + (E ^ (C & (D ^ E))) + 0xb5c9a0e6;
	B += temp1;
	F = temp1 + (((G >> 2) | (G << 30)) ^ ((G >> 13) | (G << 19)) ^ ((G >> 22) | (G << 10))) + ((G & H) | (A & (G | H)));

	temp1 = E + (((B >> 6) | (B << 26)) ^ ((B >> 11) | (B << 21)) ^ ((B >> 25) | (B << 7))) + (D ^ (B & (C ^ D))) + 0x532fb63c;
	A += temp1;
	E = temp1 + (((F >> 2) | (F << 30)) ^ ((F >> 13) | (F << 19)) ^ ((F >> 22) | (F << 10))) + ((F & G) | (H & (F | G)));

	temp1 = D + (((A >> 6) | (A << 26)) ^ ((A >> 11) | (A << 21)) ^ ((A >> 25) | (A << 7))) + (C ^ (A & (B ^ C))) + 0xd2c741c6;
	H += temp1;
	D = temp1 + (((E >> 2) | (E << 30)) ^ ((E >> 13) | (E << 19)) ^ ((E >> 22) | (E << 10))) + ((E & F) | (G & (E | F)));

	temp1 = C + (((H >> 6) | (H << 26)) ^ ((H >> 11) | (H << 21)) ^ ((H >> 25) | (H << 7))) + (B ^ (H & (A ^ B))) + 0x107237ea3;
	G += temp1;
	C = temp1 + (((D >> 2) | (D << 30)) ^ ((D >> 13) | (D << 19)) ^ ((D >> 22) | (D << 10))) + ((D & E) | (F & (D | E)));

	temp1 = B + (((G >> 6) | (G << 26)) ^ ((G >> 11) | (G << 21)) ^ ((G >> 25) | (G << 7))) + (A ^ (G & (H ^ A))) + 0xa4954b68;
	F += temp1;
	B = temp1 + (((C >> 2) | (C << 30)) ^ ((C >> 13) | (C << 19)) ^ ((C >> 22) | (C << 10))) + ((C & D) | (E & (C | D)));

	temp1 = A + (((F >> 6) | (F << 26)) ^ ((F >> 11) | (F << 21)) ^ ((F >> 25) | (F << 7))) + (H ^ (F & (G ^ H))) + 0x4c191d76;
	E += temp1;
	A = temp1 + (((B >> 2) | (B << 30)) ^ ((B >> 13) | (B << 19)) ^ ((B >> 22) | (B << 10))) + ((B & C) | (D & (B | C)));

    ctx->state[0] += A;
    ctx->state[1] += B;
    ctx->state[2] += C;
    ctx->state[3] += D;
    ctx->state[4] += E;
    ctx->state[5] += F;
    ctx->state[6] += G;
    ctx->state[7] += H;
}

static uint8 sha256_padding[64] =
{
 0x80, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0,	0, 0, 0, 0, 0, 0, 2, 0
};

void sha256_finish(sha256_context *ctx, uint8 digest[32])
{
    sha256_process_in_finish(ctx, sha256_padding);

    PUT_UINT32(ctx->state[0], digest, 0);
    PUT_UINT32(ctx->state[1], digest, 4);
    PUT_UINT32(ctx->state[2], digest, 8);
    PUT_UINT32(ctx->state[3], digest, 12);
    PUT_UINT32(ctx->state[4], digest, 16);
    PUT_UINT32(ctx->state[5], digest, 20);
    PUT_UINT32(ctx->state[6], digest, 24);
    PUT_UINT32(ctx->state[7], digest, 28);
}

void sha256_32byte(uint8* input, uint8 output[32])
{
	sha256_context ctx;
	sha256_starts(&ctx);
	sha256_process(&ctx, input);
	sha256_finish(&ctx, output);
}
